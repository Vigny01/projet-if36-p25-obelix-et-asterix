---
title: 'Analyse croisée : Superstore & Walmart'
subtitle: "Obelix et Asterix"
author: "Membre: TAKAM TALLA Vigny Brayan, Arthur KAMGA, Chengxian ZHAO, Jianghao LIU"
date: "2025-04-27"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

## Introduction

### Contexte et objectif

Dans le cadre de ce projet, nous avons travaillé avec **deux jeux de données différents mais complémentaires**. Ces données permettent d’explorer plusieurs aspects du commerce de détail : les ventes, les produits, les clients, la rentabilité, etc.

- Le premier fichier, appelé *Superstore*, regroupe presque 10 000 lignes de commandes passées dans une entreprise fictive de e-commerce.
- Le second fichier, basé sur des ventes dans des magasins Walmart, contient des données orientées “point de vente” : horaires, satisfaction client, modes de paiement...

L’objectif est de **mener une exploration** sur les données. Nous avons voulu comprendre comment ces systèmes fonctionnent, ce qui génère du profit ou non, et peut-être découvrir des profils de clients, des tendances d’achat ou des produits phares.  

## Structure et nature des données

####  [Données Superstore](https://www.kaggle.com/datasets/aksha17/superstore-sales)

Ce fichier CSV contient **9994 lignes** et **21 variables**. Il s’agit d’un historique de ventes avec des informations sur les commandes, les clients, les produits et la logistique.

**Variables numériques :**

- `Sales` : montant de la vente.
- `Quantity` : nombre d’unités vendues.
- `Discount` : remise appliquée.
- `Profit` : profit net.
- `Postal Code`, `Row ID` : identifiants.

**Variables temporelles :**

- `Order Date` : date de commande.
- `Ship Date` : date d’expédition.

**Variables nominales :**

- `Order ID`, `Customer ID`, `Product ID` : identifiants.
- `Customer Name` : nom du client.
- `Segment` : type de client.
- `Region`, `State`, `City` : localisation.
- `Ship Mode` : mode d’expédition.
- `Category`, `Sub-Category`, `Product Name` : classification des produits.


#### [Données Walmart](https://www.kaggle.com/datasets/antaesterlin/walmart-commerce-data)

Ce fichier CSV contient **1000 transactions** et **20 variables**. Il fournit des données détaillées sur chaque vente : prix, quantité, mode de paiement, heure, etc.

**Variables numériques :**

- `unit_price` : prix unitaire.
- `quantity` : quantité achetée.
- `vat` : taxe.
- `total` : montant total payé.
- `cogs` : coût du produit.
- `gross_margin_pct` : pourcentage de marge brute.
- `gross_income` : bénéfice.
- `rating` : note du client (sur 10).

**Variables temporelles :**

- `dtme` : date de la vente.
- `tme` : heure.
- `time_of_day` : moment (matin, après-midi...).
- `day_name`, `month_name` : jour et mois de l’achat.

**Variables nominales :**

- `invoice_id` : identifiant de facture.
- `branch`, `city` : lieu.
- `customer_type` : type de client.
- `gender` : genre.
- `product_line` : type de produit.
- `payment_method` : moyen de paiement.



## Chargement des packages et des données
```{r message=FALSE}
library(ggplot2)
library(dplyr)
library(readr)
library(lubridate)
library(patchwork) # important pour combiner les plots
Sys.setlocale("LC_TIME", "fr_FR.UTF-8")

# Importer les données
superstore <- read_csv("data/superstore.csv")
walmart <- read_delim("data/Walmart.csv", delim = ";")
walmart_time <-walmart
```
## Question 1

1. Problématique

**Questions posées :**

- Quel est le genre des clients qui achetent le plus ?
- Comment les ventes varient-elles selon le segment de clientèle (Consumer, Corporate, Home Office) ?

**Réponse imaginée :**

On pourrait s’attendre à ce qu’un genre dépense légèrement plus que l’autre.

Concernant les segments, il est possible que les consommateurs génèrent plus de ventes que les autres catégories de clients.

- **Titre** : Dépenses par Genre (Walmart)
  
- **Axes** :
  - **X** : Genre (Female, Male)
  - **Y** : Montant total des dépenses

- **Légende** : Genre (rose pour Female, bleu pour Male)

- Outliers (points rouges)
- Médiane (trait central du boxplot)

### Graphique 2 (à droite) :

- **Titre** : Montant des ventes par Segment (Superstore)
  
- **Axes** :
  - **X** : Segment (Consumer, Corporate, Home Office)
  - **Y** : Montant des ventes

- **Légende** : Segment (couleurs différentes pour chaque segment)
  - Outliers(points rouges)
  - Médiane représentée (trait central du boxplot)




```{r, echo = FALSE}

# Créer les deux graphiques
plot1 <- ggplot(walmart, aes(x = gender, y = total, fill = gender)) +
  geom_boxplot(outlier.color = "red", outlier.size = 1.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "yellow") +
  coord_cartesian(ylim = c(0, 1500)) +
  labs(title = "Ventes par genre de client") +
  theme_minimal()

plot2 <- ggplot(superstore, aes(x = Segment, y = Sales, fill = Segment)) +
  geom_boxplot(outlier.color = "red", outlier.size = 1.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "yellow") +
  coord_cartesian(ylim = c(0, 1500)) +
  labs(title = "Ventes par Segment de clients") +
  theme_minimal()

# Les afficher côte à côte
(plot1 + plot2) + 
  plot_layout(widths = c(1, 2))
```

### Analyse du premier graphique :

En observant les dépenses par genre, on remarque que les femmes ont tendance à dépenser légèrement plus que les hommes, bien que la dispersion des dépenses soit assez similaire entre les deux groupes. Il y a également plusieurs points aberrants, ce qui suggère qu'il existe des clients ayant des dépenses particulièrement élevées dans les deux catégories. Cette différence de dépenses entre les genres semble donc présente, bien que limitée. Cependant, cela soulève une question intéressante : Quel rôle pourrait jouer le type de produit acheté dans ces écarts de dépenses ?

### Analyse du deuxième graphique :

Pour le graphique des ventes par segment, on remarque que les médianes sont assez proches entre les segments "Consumer", "Corporate" et "Home Office". Cependant, la distribution des ventes est assez similaire pour tous les segments, avec une forte présence de points aberrants vers le haut. Le segment "Consumer" semble légèrement en tête, générant davantage de ventes élevées que les autres. Cela dit, les différences entre les segments ne sont pas énormes.

### Question : Quels produits sont beaucoup achetés ?

**Données utilisées** : `product_line` et `quantity` (jeu de données Walmart)

---

### Méthode

Pour répondre on a:

- Utiliser **product_line** pour identifier les produits.
- Utiliser **quantity** pour mesurer combien de fois chaque produit a été acheté.
- Additionner les quantités par type de produit.
- Classer les produits du plus acheté au moins acheté

---

### Visualisation : Produits les plus achetés

```{r, echo = FALSE}
library(dplyr)
# Calculer la quantité totale par type de produit
produits_walmart <- walmart %>%
  group_by(product_line) %>%
  summarise(Total_Quantity = sum(quantity, na.rm = TRUE)) %>%
  arrange(desc(Total_Quantity))

# Créer le graphique
ggplot(produits_walmart, aes(x = reorder(product_line, Total_Quantity), y = Total_Quantity)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(title = "Produits les plus achetés chez Walmart",
       x = "Produit",
       y = "Quantité totale achetée") +
  theme_minimal()
```

## Question 2: Est-ce que certains jours génèrent plus de ventes que d'autres ?

Pour répondre à cette question, nous allons étudié deux jeux de données : Superstore, qui concerne les ventes entre entreprises (B2B), et Walmart, qui concerne les ventes aux particuliers (B2C). L'approche a utilisé se structure de la manière suivante : d'abord, nous allons extraire le jour de la semaine à partir de la date de chaque commande. Ensuite, nous allons additionner les ventes totales pour chaque jour. Enfin, nous allons représenter ces résultats sous forme de graphiques en barres (barplots). Nous espérons obtenir après cette analyse, qu'il y aura: une activité principalement concentrée dans la semaine pour Superstore, et des ventes plus élevées le week-end pour Walmart

### Superstore - Ventes par jour de la semaine
```{r, echo = FALSE}
superstore <- superstore %>%
  mutate(Order_Date = as.Date(`Order Date`, format="%d-%m-%y"),
         DayOfWeek = weekdays(Order_Date)) %>%
  group_by(DayOfWeek) %>%
  summarise(Total_Sales = sum(Sales, na.rm = TRUE))

superstore$DayOfWeek <- factor(superstore$DayOfWeek,
                               levels = c("lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi", "dimanche"))

ggplot(superstore, aes(x = DayOfWeek, y = Total_Sales)) +
  geom_col(fill="steelblue") +
  geom_text(aes(label = round(Total_Sales, 0)), vjust = -0.5) +
  labs(title = "Superstore : Ventes par jour de la semaine", x = "Jour", y = "Ventes ($)") +
  theme_minimal()
```

### Analyse

On constate sur le graphique que: le mercredi, il y a très peu de ventes, le lundi et le vendredi il y a plus de vente. Cela s’explique premièrement par le fait que Superstore vend principalement à des entreprises. Ensuite, nous pouvons dire après avoir analyser et effectuer des recherches que: le lundi, les entreprises passent beaucoup de commandes pour bien commencer leur semaine. Le vendredi, elles commandent à nouveau pour préparer la semaine suivante. En revanche, le mercredi, tout est déjà organisé, donc il y a naturellement moins de commandes. Le samedi et le dimanche, il y a aussi des ventes, mais un peu moins qu’en début et en fin de semaine.


### Walmart - Ventes par jour de la semaine

```{r, echo = FALSE}

walmart <- walmart %>%
  mutate(
    dtme = as.Date(dtme),
    DayOfWeek = weekdays(dtme)
  ) %>%
  group_by(DayOfWeek) %>%
  summarise(Total_Sales = sum(total, na.rm = TRUE))

walmart$DayOfWeek <- factor(walmart$DayOfWeek,
                            levels = c("lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi", "dimanche"))

ggplot(walmart, aes(x = DayOfWeek, y = Total_Sales)) +
  geom_col(fill="darkgreen") +
  geom_text(aes(label = round(Total_Sales, 0)), vjust = -0.5) +
  labs(title = "Walmart : Ventes par jour de la semaine", x = "Jour", y = "Ventes ($)") +
  theme_minimal()
```

### Analyse
On constate sur le graphique que: le samedi, les gens achètent beaucoup plus que les autres jours. Le dimanche aussi, les ventes restent assez élevées, mais elles sont un peu moins importantes qu'au samedi. En semaine, du lundi au vendredi, les ventes sont plus régulières mais globalement plus faibles que le week-end. Nous pouvons dire après avoir analyser et effectuer des recherches que cela s'explique par le fait que : pendant la semaine, les gens sont souvent occupés par leur travail ou l'école, et ils ont donc moins de temps pour faire leurs courses. Le samedi, en revanche, ils disposent de plus de temps libre, ce qui leur permet d'acheter davantage.


## Question 3 : Est-ce qu’une réduction fait toujours gagner de l’argent ?


### Réflexion initiale

Nous nous sommes posé la question suivante : **Accorder une remise sur une vente assure-t-il toujours un bénéfice ?**  
Intuitivement, nous avons supposé que si la remise est modérée, elle pourrait stimuler les ventes sans trop impacter le profit ; mais qu'une remise trop importante risquerait au contraire de générer des pertes.

Pour valider ou invalider cette intuition, nous avons décidé de suivre une démarche en deux temps :  
- Visualiser la relation globale entre le taux de remise et le profit.  
- Approfondir l'analyse en étudiant la distribution du profit pour différents niveaux de remise.


### Méthode

Pour répondre à cette question, nous exploitons le jeu de données **Superstore**, qui contient deux variables clés :  
- `Discount` : le taux de remise appliqué sur chaque vente (entre 0% et 80%).  
- `Profit` : le bénéfice réalisé sur chaque vente.  

Notre approche comporte plusieurs étapes :

1. **Analyse exploratoire initiale** :  
   Nous utilisons d'abord un scatter plot combiné à une courbe de régression linéaire pour observer la tendance globale entre le taux de remise et le profit.

2. **Approfondissement avec une analyse catégorielle** :  
   Afin d'aller plus loin et mieux comprendre l'impact des différents niveaux de remise, nous introduisons un boxplot par groupe de taux de remise.

**Pourquoi utiliser également un boxplot ?**  
- Le boxplot nous permet d'analyser plus précisément la distribution du profit dans chaque catégorie de remise, en visualisant la médiane, les quartiles et les valeurs atypiques.  
- Cela apporte une vision plus claire et comparative entre les différents niveaux de remise.


### Visualisation

#### Partie 1 - Scatter plot : Discount vs Profit

```{r message=FALSE, echo = FALSE}
library(ggplot2)
library(dplyr)
library(readr)

# Lire les données Superstore
superstore <- read_csv("data/superstore.csv", show_col_types = FALSE)

# Visualiser Discount vs Profit avec une courbe de tendance
ggplot(superstore, aes(x = Discount, y = Profit)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +
  labs(title = "Relation entre Discount et Profit (Superstore)",
       x = "Taux de remise (Discount)",
       y = "Profit ($)") +
  theme_minimal()
```


#### Partie 2 - Boxplot : Profit par groupe de Discount

```{r, echo = FALSE}
# Nettoyer les données
superstore_clean <- superstore %>%
  filter(!is.na(Discount), !is.na(Profit))

# Créer des groupes de Discount
superstore_clean <- superstore_clean %>%
  mutate(Discount_Group = case_when(
    Discount == 0 ~ "0%",
    Discount > 0 & Discount <= 0.2 ~ "0%-20%",
    Discount > 0.2 & Discount <= 0.4 ~ "20%-40%",
    Discount > 0.4 & Discount <= 0.6 ~ "40%-60%",
    Discount > 0.6 ~ "60%-80%"
  ))

# Visualiser Boxplot
ggplot(superstore_clean, aes(x = Discount_Group, y = Profit, fill = Discount_Group)) +
  geom_boxplot() +
  labs(title = "Distribution du profit selon le taux de remise",
       x = "Catégorie de remise",
       y = "Profit ($)") +
  theme_minimal() +
  theme(legend.position = "none")
```



### Analyse

#### Avec le scatter plot :

- Nous observons une tendance globale légèrement négative entre le taux de remise et le profit.
- Plus la remise augmente, plus les profits tendent à baisser.

#### Avec le boxplot :

- La **structure des données** devient beaucoup plus claire.
- Jusqu'à **20% de remise**, les profits restent majoritairement positifs.
- Dès que la remise dépasse **40%**, la médiane du profit devient négative.
- Nous constatons également que la variabilité augmente fortement avec les remises élevées.

#### Différence entre Scatter plot et Boxplot pour ce problème :

- Le **scatter plot** nous a permis d'observer une tendance générale.
- Le **boxplot** nous permet de **comparer plus précisément les profits** selon différents niveaux de remise, en mettant en évidence :
  - Les tendances centrales (**médiane**)
  - La dispersion (**écart interquartile**)


### Conclusion

- Sans remise ou avec une remise légère (**0%-20%**), les ventes restent globalement rentables.
- Dès que la remise atteint **20%-40%**, la rentabilité diminue visiblement.
- Pour des remises supérieures à **40%**, les pertes deviennent la norme dans la majorité des cas.

Notre analyse montre que :

- Accorder une réduction importante n'assure pas un profit ; au contraire, cela augmente considérablement le risque de pertes.
- Le **scatter plot** nous a permis d'identifier une tendance générale.
- Le **boxplot** a confirmé et précisé que les remises élevées entraînent majoritairement des profits négatifs.


## Question 4 :Quels produits rapportent le plus ?

### Méthode

Pour répondre à cette question,Nous nous concentrerons principalement sur deux paramètres : 
**product_line** : ce paramètre nous informe sur le type de produit, et **gross_income** : ce paramètre nous indique le bénéfice généré par le produit.

Nous utiliserons un diagramme en barres pour analyser les données, car les catégories de produits possèdent plusieurs étiquettes différentes, tandis que le revenu des produits est une valeur unique. Après avoir trié les données, la comparaison entre les produits sera également plus intuitive.

### Visualisation

#### Bar chart: product_line et gross_income

```{r message=FALSE, echo = FALSE}
library(dplyr)
library(readr)
library(ggplot2)
library(scales)

data <- read_delim(
  "data/Walmart.csv",
  delim = ";", 
  show_col_types = FALSE
)

result <- data %>%
  group_by(product_line) %>%
  summarise(total_gross_income = sum(gross_income, na.rm = TRUE)) %>%
  arrange(desc(total_gross_income))


ggplot(result, aes(x = reorder(product_line, total_gross_income), y = total_gross_income)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() + 
  labs(title = "Revenu total par catégorie de produits",
       x = '',
       y = "Revenu brut (en dollars)") +
  scale_y_continuous(labels = dollar) +
  geom_text(aes(label = dollar(total_gross_income)), 
            position = position_stack(vjust = 0.5),
            size = 4, color = "white") +  
  theme_minimal()
```


### Résultat et Conclusion

Nous pouvons observer que les produits du supermarché Walmart sont répartis en six catégories. Parmi celles-ci, la vente de food and beverages génère le bénéfice le plus élevé, tandis que health and beauty génère le bénéfice le plus faible.
Toutefois, il est important de noter que l'écart entre eux n'est pas très important. Pour certains produits, la différence de bénéfices ne dépasse même pas 2%. De plus, tous les bénéfices dépassent 2000 dollars. Étant donné que les données collectées peuvent être influencées par le contexte social et d'autres facteurs à l'époque, nous pouvons conclure qu'au premier trimestre de 2019, la vente de food and beverages générait les bénéfices les plus élevés.


## Question 5 : Quelles catégories perdent de l’argent avec les réductions ?

Pour répondre à cette question, nous allons utiliser le dataset Superstore, qui contient des informations sur les remises, profits et catégories de produits.
Nous chercherons à analyser l'effet des niveaux de remise sur le profit moyen par catégorie, afin d’identifier celles qui deviennent non rentables lorsque des réductions sont appliquées.

### Visualisation

```{r message=FALSE, warning=FALSE, echo = FALSE}
# Nettoyage des données : s'assurer qu'il n'y a pas de NA dans les variables clés
superstore_clean <- superstore %>%
  filter(!is.na(Discount), !is.na(Profit), !is.na(Category))

# Calculer le profit moyen par catégorie selon les niveaux de remise
profit_by_discount <- superstore_clean %>%
  mutate(remise = case_when(
    Discount == 0 ~ "0%",
    Discount > 0 & Discount <= 0.2 ~ "0-20%",
    Discount > 0.2 & Discount <= 0.4 ~ "20-40%",
    Discount > 0.4 ~ ">40%"
  )) %>%
  group_by(Category, remise) %>%
  summarise(profit_moyen = mean(Profit), .groups = "drop")

# Visualisation
ggplot(profit_by_discount, aes(x = remise, y = profit_moyen, fill = Category)) +
  geom_col(position = "dodge") +
  labs(
    title = "Profit moyen par niveau de remise et catégorie",
    x = "Niveau de remise",
    y = "Profit moyen",
    fill = "Catégorie"
  ) +
  theme_minimal()
```

### Analyse
On observe que toutes les catégories deviennent non rentables lorsque la remise dépasse 40%. En particulier, la catégorie Technology affiche une perte moyenne très importante, proche de -800.

La catégorie Furniture enregistre également des pertes dès le niveau de 20–40% de remise, avec un profit moyen négatif.

En revanche, des remises plus faibles (entre 0 et 20%) restent généralement rentables pour toutes les catégories, notamment Technology, qui affiche un profit moyen positif dans cette tranche.

Cela suggère que les remises élevées (> 40%) sont globalement désavantageuses, et que leur impact varie fortement selon la catégorie de produit.


## Question 6 :Les choses chères sont-elles mieux notées ?

### Méthode

Pour répondre à cette question, nous nous concentrerons principalement sur deux paramètres : 
**unit_price** : ce paramètre indique le prix unitaire des produits, et **rating** : ce paramètre reflète la satisfaction des clients à travers leur évaluation.

Nous utiliserons un diagramme de dispersion pour analyser les données. Bien que le prix et la note soient des variables numériques, ils peuvent être considérés comme discrétisables afin de mieux visualiser leur relation. En observant la distribution des points, nous pourrons déterminer s’il existe une tendance entre le prix et la note, par exemple si les produits plus chers sont mieux notés ou s’il n’y a pas de lien clair.

### Visualisation

#### Scatter: Unit_price et rating
```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data, aes(x = unit_price, y = rating)) +
  geom_point(alpha = 0.6, color = "steelblue") +
  labs(title = "Scatter Plot of Unit Price vs Rating",
       x = "Unit Price",
       y = "Rating") +
  theme_minimal()
```


### Résultat et Conclusion

Si les produits plus chers avaient tendance à être mieux notés, les points seraient approximativement alignés en bande sur le graphique. Cependant, en observant le nuage de points, on constate que les données sont réparties de manière assez uniforme et désordonnée sur l'ensemble du graphique. On peut donc conclure qu’il n’existe pas de relation directe entre le prix unitaire et la note.
De plus, nous avons remarqué une observation intéressante : quelle que soit la valeur du prix unitaire, la note attribuée est toujours supérieure ou égale à 4.


## Question 9 – Quelle catégorie a la plus grosse marge ?

Pour répondre à cette question, nous allons analyser le dataset **Superstore**, en nous concentrant sur la **marge bénéficiaire totale** (Profit) pour chaque **catégorie de produit**.  
Nous allons visualiser la répartition des profits à l’aide d’un graphique circulaire (pie chart), afin d’identifier la catégorie la plus rentable.

### Visualisation

```{r message=FALSE, warning=FALSE, echo = FALSE}

Sys.setlocale("LC_ALL", "fr_FR.UTF-8")

# Nettoyage des données
superstore_clean <- superstore %>%
  filter(!is.na(Category), !is.na(Profit))

# Calcul du profit total par catégorie
marge_par_categorie <- superstore_clean %>%
  group_by(Category) %>%
  summarise(marge_totale = sum(Profit), .groups = "drop") %>%
  mutate(pourcentage = marge_totale / sum(marge_totale) * 100,
         etiquette = paste0(Category, " (", round(pourcentage, 1), "%)"))

# Visualisation
ggplot(marge_par_categorie, aes(x = "", y = marge_totale, fill = Category)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  geom_text(aes(label = etiquette), position = position_stack(vjust = 0.5), size = 4) +
  labs(
    title = "Répartition des marges par catégorie",
    fill = "Catégorie"
  ) +
  theme_void()

```

### Analyse
Le graphique montre la répartition des marges (profits totaux) entre les trois catégories de produits.

On observe que :

La catégorie Technology génère la plus grosse marge, représentant 50,8 % de la marge totale. Cela indique une forte rentabilité globale de cette catégorie, malgré les pertes occasionnelles en cas de fortes remises.

La catégorie Office Supplies arrive en deuxième position avec 42,8 % des marges. Elle semble relativement stable en termes de rentabilité.

En revanche, la catégorie Furniture ne représente que 6,4 % des marges totales, ce qui souligne une faible contribution au profit global de l’entreprise. Cette faible marge peut s’expliquer par une sensibilité plus forte aux remises ou des coûts plus élevés.

En résumé, la technologie est le moteur principal de la rentabilité, tandis que le mobilier semble le moins performant sur le plan des marges.


## Question 10 :Quel moment de la journée rapporte le plus ?

### Méthode

Pour répondre à cette question, nous nous concentrerons principalement sur deux paramètres :
**time_of_day** : ce paramètre indique le moment de la journée où l’achat a été effectué, et
**gross_income** : ce paramètre représente le revenu brut généré par la transaction.

Nous allons utiliser le graphique en Dount Chart pour analyser les données, car il est plus facile de visualiser le pourcentage des revenus au fil du temps pour différentes périodes. En comparant le revenu total généré à chaque moment de la journée, nous serons en mesure d’identifier les périodes les plus rentables et ainsi déterminer quel moment de la journée rapporte le plus d’argent.


### Visualisation

#### Bar chart: time_of_day et gross_income
```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}

income_by_time <- data %>%
  group_by(time_of_day) %>%
  summarise(total_income = sum(gross_income, na.rm = TRUE)) %>%
  arrange(desc(total_income))

income_by_time$time_of_day <- factor(income_by_time$time_of_day,
                                     levels = c("morning", "afternoon", "evening"))
income_by_time <- income_by_time %>%
  mutate(percent = total_income / sum(total_income) * 100,
         label = paste0(round(percent, 1), "%\n$", round(total_income, 1)))

ggplot(income_by_time, aes(x = 2, y = total_income, fill = time_of_day)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar(theta = "y", start = 0) +
  xlim(0.5, 2.5) +
  geom_text(aes(label = label), position = position_stack(vjust = 0.5), color = "white") +
  labs(title = "Répartition du revenu par tranche horaire de la journée") +
  theme_void() +
  theme(legend.title = element_blank())
```


### Résultat et Conclusion

D’après le diagramme en barres, on peut clairement observer que les ventes du matin génèrent le moins de bénéfices, suivies de l’après-midi, tandis que les ventes du soir rapportent le plus. De plus, les bénéfices du matin représentent moins de la moitié de ceux de l’après-midi, alors que la différence entre l’après-midi et le soir n’est pas très marquée.

Cela m’a fait penser au cours Éthique et biais de visualisation : comme les tranches horaires du champ time_of_day sont déjà prédéfinies dans le jeu de données, nous ne connaissons pas la répartition exacte des heures. Il est donc possible que, si l’intervalle de l’après-midi avait été légèrement élargi lors de la collecte des données, cela aurait pu inverser les résultats et faire apparaître l’après-midi comme la période la plus rentable. Ce constat est assez intéressant.

## Question 13 :Quelle région est la plus performante en termes de rentabilité ?

### Méthode
Pour cette analyse, nous avons utilisé le jeu de données Superstore, en nous concentrant sur trois variables clés :

Region : la région géographique (East, West, South, Central)

Sales : le chiffre d’affaires

Profit : le bénéfice

Nous avons procédé en deux étapes :

Agrégation des données par région, pour obtenir :

Le total des ventes

Le total des profits

La marge bénéficiaire (Profit / Sales)

Visualisation via un treemap :

La taille de chaque bloc représente le volume des ventes

La couleur reflète la marge bénéficiaire

Un code couleur du rouge (moins rentable) au vert (plus rentable) facilite l’interprétation visuelle

### Visualisation

```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
if (!requireNamespace("treemapify", quietly = TRUE)) {
  install.packages("treemapify")
}

library(treemapify)

# Préparation des données : calcul par région
region_profitability <- superstore %>%
  filter(!is.na(Sales), !is.na(Profit), !is.na(Region)) %>%
  group_by(Region) %>%
  summarise(
    total_sales = sum(Sales),
    total_profit = sum(Profit),
    profit_margin = total_profit / total_sales,
    .groups = "drop"
  )

# Treemap avec des couleurs plus douces
ggplot(region_profitability, 
       aes(area = total_sales, 
           fill = profit_margin, 
           label = paste0(Region, "\n", round(profit_margin*100, 1), "%"))) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE, reflow = TRUE) +
  scale_fill_gradient2(
    low = "#B22222",    
    mid = "#F0E68C",    
    high = "#228B22",   
    midpoint = mean(region_profitability$profit_margin),
    name = "Marge bénéficiaire"
  ) +
  labs(title = "Rentabilité par région (taille = ventes, couleur = marge)") +
  theme_minimal()


```

### Analyse
La région West se démarque nettement avec la plus forte marge bénéficiaire : 14.9%.

Elle est suivie par East (13.5%) et South (11.9%), qui présentent également une rentabilité raisonnable.

En revanche, la région Central affiche la rentabilité la plus faible, avec une marge de seulement 7.9%.

En termes de volume de ventes (taille des blocs), East et West ont des ventes plus importantes que South et Central, ce qui signifie qu’elles combinent à la fois volume et rentabilité.

Le treemap permet ici une visualisation doublement efficace : il nous montre où se réalisent les ventes et dans quelle mesure ces ventes sont profitables.

Cette analyse suggère que pour maximiser la rentabilité, l’entreprise pourrait étudier les pratiques commerciales mises en œuvre dans la région West, et envisager des actions correctives dans la région Central.

## Question 15 :Est-ce que la façon de payer change le prix moyen ?

### Méthode

Pour répondre à cette question, nous allons nous concentrer sur deux paramètres :

**payment_method** : ce paramètre indique le mode de paiement utilisé par le client.

**total**: ce paramètre représente le montant total payé par le client lors de l’achat.

Nous allons utiliser un diagramme en boîte (boxplot) pour visualiser la distribution des montants en fonction des différentes méthodes de paiement. Le boxplot permet de représenter de manière claire la médiane, les quartiles ainsi que les valeurs aberrantes, ce qui nous aide à déterminer si certains moyens de paiement sont associés à des niveaux de dépenses différents, et donc si la méthode de paiement a une influence sur le montant payé par les clients.


### Visualisation

#### Boxplot: payment_method et total
```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}


ggplot(data, aes(x = payment_method, y = total, fill = payment_method)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Répartition du montant total des dépenses selon les différents modes de paiement",
       x = "payment_method",
       y = "Total") +
  theme_minimal() +
  theme(legend.position = "none")
```


### Résultat et Conclusion
Les trois méthodes de paiement (espèces, portefeuille électronique, carte de crédit) ne présentent pas de différences significatives en termes de montant moyen payé, leurs médianes étant relativement proches.
La distribution des montants est également similaire entre les différentes méthodes, avec un nombre et une répartition des valeurs aberrantes globalement comparables.
Par conséquent, on peut considérer qu’il n’y a pas d’influence notable de la méthode de paiement sur le montant moyen des achats.

## Question 17 :Quelle boutique gagne le plus d’argent ?

### Méthode

Pour identifier la boutique (ville) la plus rentable, nous avons :

Agrégé les profits totaux par ville (City)

Conserver la région (Region) pour visualiser les différences géographiques

Sélectionné les 30 villes les plus rentables

Utilisé un graphe en nuage de bulles (Bubble Cloud) : la taille des bulles représente le profit total, la couleur la région

Ce type de visualisation est plus expressif qu’un simple diagramme en barres : il attire l’attention sur les villes les plus profitables tout en offrant une vision globale de la répartition.

### Visualisation
```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
if (!requireNamespace("packcircles", quietly = TRUE)) {
  install.packages("packcircles")
}
if (!requireNamespace("ggrepel", quietly = TRUE)) {
  install.packages("ggrepel")
}

library(packcircles)
library(ggplot2)
library(ggrepel)
library(dplyr)

city_profit <- superstore %>%
  filter(!is.na(City), !is.na(Profit)) %>%
  group_by(City, Region) %>%
  summarise(profit_total = sum(Profit), .groups = "drop") %>%
  arrange(desc(profit_total)) %>%
  slice_max(profit_total, n = 30)

packing <- circleProgressiveLayout(city_profit$profit_total, sizetype = 'area')
city_profit <- cbind(city_profit, packing)

dat.gg <- circleLayoutVertices(packing, npoints = 50)

ggplot() + 
  geom_polygon(data = dat.gg, aes(x, y, group = id, fill = city_profit$Region[id]), colour = "white", alpha = 0.8) +
  geom_text(data = city_profit, aes(x, y, label = City), size = 3, color = "black") +
  scale_fill_brewer(palette = "Set2") +
  theme_void() +
  coord_equal() +
  labs(
    title = "Top 30 des boutiques les plus rentables",
    subtitle = "Taille des bulles = profit total, couleur = région",
    fill = "Région"
  )

```

### Analyse

Le graphique met en évidence les 30 boutiques (villes) les plus rentables à travers un nuage de bulles :

La ville la plus rentable est New York City, avec la plus grande bulle, représentant un profit total nettement supérieur aux autres. Elle appartient à la région South (couleur orange clair).

Viennent ensuite Los Angeles, Seattle et San Francisco, toutes trois situées dans la région West (rose), montrant que cette région concentre plusieurs boutiques fortement profitables.

La taille des bulles permet de comparer visuellement les profits totaux, tandis que les couleurs indiquent la répartition géographique :

West domine en nombre de boutiques rentables dans ce top 30.

South est représentée en tête avec New York City.

East et Central sont présentes, mais avec des bulles globalement plus petites, ce qui suggère des profits moins élevés.

Ce type de visualisation permet de comparer rapidement les performances financières des boutiques tout en localisant leur région, offrant ainsi une analyse à double entrée (rentabilité + géographie).

Conclusion:
La boutique générant le plus de profit est New York City, située dans la région South.

Les régions West et South dominent clairement en termes de rentabilité parmi les 30 meilleures boutiques, ce qui pourrait orienter les décisions stratégiques futures, comme l’ouverture de nouvelles boutiques ou la priorisation des investissements.

## Question 18 :Une réduction pousse-t-elle à acheter plus ?

### Méthode

Pour répondre à cette question, nous allons nous concentrer sur deux paramètres :

**Discount**: Remise appliquée.

**Quantity** : Nombre d’unités vendues.


Nous utiliserons un graphique de dispersion pour visualiser la relation entre la remise et la quantité d'achat correspondante pour chaque transaction. Si le phénomène de "réductions plus importantes, plus d'achats" est vrai, nous pouvons observer une tendance de corrélation positive dans le graphique (les points de données sont distribués en bas de gauche en haut à droite). Inversement, s'il n'y a pas de modèle évident, cela peut indiquer que la remise a peu d'impact sur la quantité d'achat.

### Visualisation

#### Line chart: Discount et Quantity
```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
data_superStore <- read_delim(
  "data/superstore.csv",
)

ggplot(data_superStore, aes(x = Discount, y = Quantity)) +
  geom_point(alpha = 0.5, color = "steelblue") +
  labs(title = "Relation entre la réduction et la quantité achetée",
       x = "Réduction (Discount)",
       y = "Quantité achetée") +
  theme_minimal()
```


### Résultat et Conclusion
Les parcelles de dispersion montrent que la plupart des transactions sont effectuées à faible remise et que le nombre d'achats est généralement stable. Le nombre de ventes dans différentes remises est essentiellement la distribution d'évaluation.En d'autres termes, dans cet ensemble de données, les remises ne semblent pas encourager clairement les clients à acheter plus.


## Question 20 : À quelle heure achète-t-on le plus ?

Pour répondre à cette question, nous allons utiliser le jeu de données Walmart. Deux variables vont être étudiées : tme, qui correspond à l'heure de la transaction, et total, qui indique le montant de la vente. L'approche à utiliser se structure de la manière suivante : d'abord, nous allons extraire l'heure à partir de la variable tme. Ensuite, nous allons additionner les ventes totales pour chaque heure. Enfin, nous allons représenter ces résultats sous forme de graphique en barres (barplot). Nous espérons obtenir après cette analyse qu'il y aura : un pic de ventes autour de midi, et un second pic en fin de journée.

### Walmart - Répartition des ventes par heure

```{r, echo = FALSE}
walmart_time <- walmart_time %>%
  mutate(Hour = hour(hms(tme))) %>%
  group_by(Hour) %>%
  summarise(Total_Sales = sum(total, na.rm = TRUE))

ggplot(walmart_time, aes(x = Hour, y = Total_Sales)) +
  geom_col(fill = "darkblue") +
  geom_text(aes(label = round(Total_Sales, 0)), vjust = -0.5) +
  labs(title = "Walmart : Ventes totales par heure", x = "Heure de la journée", y = "Ventes ($)") +
  scale_x_continuous(breaks = 0:23) +
  theme_minimal()
```

### Analyse

On constate sur le graphique que: la plupart des gens font leurs achats surtout autour de midi, entre 12h et 13h et en soirée, entre 18h-19h. L'interprétation qu'on peut faire est que les gens profitent de leur pause déjeuner de midi pour faire quelques courses ou acheter ce dont ils ont besoin rapidement. Aussi en soirée, les gens sortent du travail et s’arrêtent souvent au magasin avant de rentrer chez eux. En revanche, tôt le matin et tard le soir, il y a beaucoup moins de ventes, car les gens dorment, travaillent ou préfèrent rester tranquillement chez eux.






